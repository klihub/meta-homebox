# short-description: Create a disk image with syslinux as bootloader
# long-description: Creates a DOS-partitioned disk image that can be
# directly dd'd to a boot media. The bootloader used is syslinux and
# it is on the first VFAT-formatted partition. There are two partitions
# with a copy of the content from the image rootfs, for A/B-partitioned
# updates. Optionally there is also a fourth dedicated partition for
# storing device-specific configuration/data.

bootloader --ptable msdos --timeout=50 --append="initrd=/initrd root=LABEL=${HOMEBOX_LABEL_ROOT1"

part /boot --source syslinux-alix --fstype=vfat --fixed-size ${HOMEBOX_BOOTFS_SIZE}M --label ${HOMEBOX_LABEL_BOOT} --active --align 1024

part / --source rootfs --fstype=ext4 --fixed-size ${HOMEBOX_ROOTFS_SIZE}M --rootfs-dir=${IMAGE_ROOTFS} --label ${HOMEBOX_LABEL_ROOT1} --align 1024 ${HOMEBOX_WIC_ROOT_EXCLUDES}

part / --source rootfs --fstype=ext4 --fixed-size ${HOMEBOX_ROOTFS_SIZE}M --rootfs-dir=${IMAGE_ROOTFS} --label ${HOMEBOX_LABEL_ROOT2} --align 1024 ${HOMEBOX_WIC_ROOT_EXCLUDES}

#part /config --source rootfs --fstype=ext4 --fixed-size ${HOMEBOX_CONFFS_SIZE}M --rootfs-dir=${IMAGE_ROOTFS}/conf --align 1024

${HOMEBOX_WIC_EXTRA_PARTITIONS}
